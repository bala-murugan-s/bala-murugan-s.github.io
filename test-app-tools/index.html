<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansible SD-WAN Automation - Multi-Vendor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0ea5e9;
            --secondary: #8b5cf6;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --darker: #020617;
            --card: #1e293b;
            --border: #334155;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--text);
            overflow-x: hidden;
        }

        /* Animated Background Pattern */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(14, 165, 233, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .app-container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Top Navigation */
        .top-nav {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
        }

        .logo-text {
            font-size: 1.4em;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-actions {
            display: flex;
            gap: 12px;
        }

        /* Main Layout */
        .main-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar Steps */
        .sidebar {
            width: 280px;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--border);
            padding: 24px 16px;
            overflow-y: auto;
        }

        .step-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .step-item {
            padding: 16px;
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .step-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .step-item:hover {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .step-item.active {
            border-color: var(--primary);
            background: rgba(14, 165, 233, 0.1);
        }

        .step-item.active::before {
            opacity: 1;
        }

        .step-item.completed {
            border-color: var(--success);
        }

        .step-number {
            width: 28px;
            height: 28px;
            background: var(--border);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .step-item.active .step-number {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .step-item.completed .step-number {
            background: var(--success);
        }

        .step-item.completed .step-number::after {
            content: '‚úì';
        }

        .step-title {
            font-weight: 600;
            font-size: 0.95em;
            margin-bottom: 4px;
        }

        .step-desc {
            font-size: 0.8em;
            color: var(--text-muted);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-header {
            padding: 32px;
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
        }

        .content-header h2 {
            font-size: 2em;
            margin-bottom: 8px;
        }

        .content-header p {
            color: var(--text-muted);
            font-size: 1em;
        }

        .progress-container {
            margin-top: 20px;
        }

        .progress-bar {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.5s;
            width: 0%;
        }

        .progress-text {
            margin-top: 8px;
            font-size: 0.85em;
            color: var(--text-muted);
        }

        .content-body {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        /* Step Content */
        .step-content {
            display: none;
            animation: fadeIn 0.4s;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .card {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.1), rgba(139, 92, 246, 0.1));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(14, 165, 233, 0.2);
        }

        .card.selected {
            border-color: var(--primary);
            background: rgba(14, 165, 233, 0.1);
        }

        .card.selected::before {
            opacity: 1;
        }

        .card-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .card-desc {
            color: var(--text-muted);
            font-size: 0.9em;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        .card-badge {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            margin-top: 12px;
            position: relative;
            z-index: 1;
        }

        /* Section */
        .section {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .section-title {
            font-size: 1.2em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Form Elements */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-size: 0.85em;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 14px;
            background: var(--darker);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.95em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Monaco', monospace;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(14, 165, 233, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-group:hover {
            background: rgba(14, 165, 233, 0.1);
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            cursor: pointer;
            font-size: 0.95em;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .data-table th {
            text-align: left;
            padding: 12px;
            background: var(--darker);
            border: 1px solid var(--border);
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .data-table td {
            padding: 12px;
            border: 1px solid var(--border);
        }

        .data-table input {
            width: 100%;
            padding: 8px;
            background: var(--darker);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text);
        }

        .data-table select {
            width: 100%;
            padding: 8px;
            background: var(--darker);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text);
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
        }

        .btn-secondary {
            background: var(--card);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* Footer Navigation */
        .footer-nav {
            padding: 24px 32px;
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 40px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--dark);
            border: 2px solid var(--border);
            border-radius: 20px;
            max-width: 1200px;
            width: 100%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            padding: 24px 32px;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: 700;
        }

        .modal-tabs {
            display: flex;
            gap: 8px;
            padding: 16px 32px;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
        }

        .modal-tab {
            padding: 10px 18px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
            white-space: nowrap;
        }

        .modal-tab:hover {
            color: var(--text);
        }

        .modal-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }

        pre {
            margin: 0 !important;
            border-radius: 8px !important;
        }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .summary-card {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }

        .summary-label {
            font-size: 0.85em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-value {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }

        .summary-detail {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        /* Site List */
        .site-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .site-item {
            display: grid;
            grid-template-columns: auto 1fr auto auto auto;
            gap: 16px;
            align-items: center;
            padding: 16px;
            background: rgba(14, 165, 233, 0.05);
            border: 2px solid var(--border);
            border-radius: 12px;
            transition: all 0.3s;
        }

        .site-item:hover {
            border-color: var(--primary);
        }

        .site-checkbox {
            width: 20px;
            height: 20px;
        }

        .site-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .site-name {
            font-weight: 600;
            font-size: 1.1em;
        }

        .site-meta {
            font-size: 0.85em;
            color: var(--text-muted);
        }

        .site-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-ready {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .site-score {
            font-weight: 700;
            font-size: 1.1em;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--darker);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .main-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                max-height: 200px;
                display: flex;
                overflow-x: auto;
                padding: 16px;
            }

            .step-list {
                flex-direction: row;
                gap: 12px;
            }

            .step-item {
                min-width: 180px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    <a href="../../index.html" class="back-link">‚Üê Back to Home</a>
    
    <div class="app-container">
        <!-- Top Navigation -->
        <div class="top-nav">
            <div class="logo">
                <div class="logo-icon">üåê</div>
                <div class="logo-text">SD-WAN Automation</div>
            </div>
            <div class="nav-actions">
                <button class="btn btn-secondary" onclick="loadFromCache()">üìÇ Load</button>
                <button class="btn btn-secondary" onclick="saveToCache()">üíæ Save</button>
                <button class="btn btn-secondary" onclick="clearCache()">üóëÔ∏è Clear</button>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="step-list">
                    <div class="step-item active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-title">Vendor Selection</div>
                        <div class="step-desc">Choose SD-WAN platform</div>
                    </div>
                    <div class="step-item" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-title">Site Configuration</div>
                        <div class="step-desc">Define site details</div>
                    </div>
                    <div class="step-item" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-title">WAN Circuits</div>
                        <div class="step-desc">Configure connections</div>
                    </div>
                    <div class="step-item" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-title">LAN Networks</div>
                        <div class="step-desc">VLAN configuration</div>
                    </div>
                    <div class="step-item" data-step="5">
                        <div class="step-number">5</div>
                        <div class="step-title">Policies</div>
                        <div class="step-desc">QoS & routing rules</div>
                    </div>
                    <div class="step-item" data-step="6">
                        <div class="step-number">6</div>
                        <div class="step-title">Multi-Site</div>
                        <div class="step-desc">Bulk deployment</div>
                    </div>
                    <div class="step-item" data-step="7">
                        <div class="step-number">7</div>
                        <div class="step-title">Review</div>
                        <div class="step-desc">Generate playbooks</div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <div class="content-header">
                    <h2 id="step-title">Select SD-WAN Vendor</h2>
                    <p id="step-desc">Choose your SD-WAN platform to begin configuration</p>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-text" id="progress-text">Step 1 of 7</div>
                    </div>
                </div>

                <div class="content-body">
                    <!-- Step 1: Vendor Selection -->
                    <div class="step-content active" data-step="1">
                        <div class="card-grid">
                            <div class="card" data-vendor="cisco">
                                <div class="card-icon">üî∑</div>
                                <div class="card-title">Cisco SD-WAN</div>
                                <div class="card-desc">vManage-based orchestration with feature templates and centralized policies</div>
                                <span class="card-badge">Enterprise</span>
                            </div>
                            <div class="card" data-vendor="fortinet">
                                <div class="card-icon">üõ°Ô∏è</div>
                                <div class="card-title">Fortinet SD-WAN</div>
                                <div class="card-desc">FortiOS-based SD-WAN with Security Fabric integration and ADVPN</div>
                                <span class="card-badge">Integrated</span>
                            </div>
                            <div class="card" data-vendor="prisma">
                                <div class="card-icon">‚òÅÔ∏è</div>
                                <div class="card-title">Prisma SD-WAN</div>
                                <div class="card-desc">Cloud-managed ION devices with autonomous branch architecture</div>
                                <span class="card-badge">Cloud-Native</span>
                            </div>
                            <div class="card" data-vendor="velocloud">
                                <div class="card-icon">‚ö°</div>
                                <div class="card-title">VMware VeloCloud</div>
                                <div class="card-desc">Dynamic Multipath Optimization with cloud orchestration</div>
                                <span class="card-badge">Popular</span>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Site Configuration -->
                    <div class="step-content" data-step="2">
                        <div class="section">
                            <div class="section-header">
                                <div class="section-title">üìç Site Information</div>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Site Name</label>
                                    <input type="text" id="site-name" value="Branch-NYC-01" placeholder="e.g., Branch-NYC-01">
                                </div>
                                <div class="form-group">
                                    <label>Site ID</label>
                                    <input type="text" id="site-id" value="1001" placeholder="Unique identifier">
                                </div>
                                <div class="form-group">
                                    <label>Site Type</label>
                                    <select id="site-type">
                                        <option value="branch">Branch Office</option>
                                        <option value="hq">Headquarters</option>
                                        <option value="dc">Data Center</option>
                                        <option value="remote">Remote Office</option>
                                        <option value="retail">Retail Store</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Timezone</label>
                                    <select id="site-timezone">
                                        <option value="America/New_York">America/New_York</option>
                                        <option value="America/Los_Angeles">America/Los_Angeles</option>
                                        <option value="America/Chicago">America/Chicago</option>
                                        <option value="Europe/London">Europe/London</option>
                                        <option value="Asia/Singapore">Asia/Singapore</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Expected Users</label>
                                    <select id="site-users">
                                        <option value="1-25">1-25 users</option>
                                        <option value="25-50">25-50 users</option>
                                        <option value="50-100" selected>50-100 users</option>
                                        <option value="100-250">100-250 users</option>
                                        <option value="250+">250+ users</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Criticality</label>
                                    <select id="site-criticality">
                                        <option value="high">High</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="low">Low</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Address</label>
                                    <input type="text" id="site-address" value="123 Broadway, NYC, NY 10001" placeholder="Physical address">
                                </div>
                                <div class="form-group">
                                    <label>Contact Email</label>
                                    <input type="email" id="site-contact" value="admin@company.com" placeholder="site-admin@company.com">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: WAN Circuits -->
                    <div class="step-content" data-step="3">
                        <div class="section">
                            <div class="section-header">
                                <div class="section-title">üîå WAN Connections</div>
                                <button class="btn btn-secondary btn-icon" onclick="addWanCircuit()">+</button>
                            </div>
                            <table class="data-table" id="wan-table">
                                <thead>
                                    <tr>
                                        <th>Circuit</th>
                                        <th>Type</th>
                                        <th>ISP</th>
                                        <th>Download (Mbps)</th>
                                        <th>Upload (Mbps)</th>
                                        <th>Public IP</th>
                                        <th>Priority</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><input type="text" value="WAN-1" class="wan-name"></td>
                                        <td>
                                            <select class="wan-type">
                                                <option value="internet">Internet</option>
                                                <option value="mpls">MPLS</option>
                                                <option value="4g">4G/LTE</option>
                                                <option value="5g">5G</option>
                                            </select>
                                        </td>
                                        <td><input type="text" value="Comcast" class="wan-isp"></td>
                                        <td><input type="number" value="100" class="wan-download"></td>
                                        <td><input type="number" value="20" class="wan-upload"></td>
                                        <td><input type="text" value="203.0.113.10" class="wan-ip"></td>
                                        <td>
                                            <select class="wan-priority">
                                                <option value="1">Primary</option>
                                                <option value="2">Backup</option>
                                                <option value="3">Tertiary</option>
                                            </select>
                                        </td>
                                        <td><button class="btn btn-secondary btn-icon" onclick="removeRow(this)">üóëÔ∏è</button></td>
                                    </tr>
                                    <tr>
                                        <td><input type="text" value="WAN-2" class="wan-name"></td>
                                        <td>
                                            <select class="wan-type">
                                                <option value="internet">Internet</option>
                                                <option value="mpls" selected>MPLS</option>
                                                <option value="4g">4G/LTE</option>
                                                <option value="5g">5G</option>
                                            </select>
                                        </td>
                                        <td><input type="text" value="Verizon" class="wan-isp"></td>
                                        <td><input type="number" value="50" class="wan-download"></td>
                                        <td><input type="number" value="50" class="wan-upload"></td>
                                        <td><input type="text" value="192.0.2.20" class="wan-ip"></td>
                                        <td>
                                            <select class="wan-priority">
                                                <option value="1">Primary</option>
                                                <option value="2" selected>Backup</option>
                                                <option value="3">Tertiary</option>
                                            </select>
                                        </td>
                                        <td><button class="btn btn-secondary btn-icon" onclick="removeRow(this)">üóëÔ∏è</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Step 4: LAN Networks -->
                    <div class="step-content" data-step="4">
                        <div class="section">
                            <div class="section-header">
                                <div class="section-title">üè¢ LAN Configuration</div>
                                <button class="btn btn-secondary btn-icon" onclick="addLanVlan()">+</button>
                            </div>
                            <table class="data-table" id="lan-table">
                                <thead>
                                    <tr>
                                        <th>VLAN ID</th>
                                        <th>Name</th>
                                        <th>Subnet</th>
                                        <th>Gateway</th>
                                        <th>DHCP</th>
                                        <th>Security Zone</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><input type="number" value="10" class="vlan-id"></td>
                                        <td><input type="text" value="Corporate" class="vlan-name"></td>
                                        <td><input type="text" value="10.1.10.0/24" class="vlan-subnet"></td>
                                        <td><input type="text" value="10.1.10.1" class="vlan-gateway"></td>
                                        <td><input type="checkbox" checked class="vlan-dhcp"></td>
                                        <td>
                                            <select class="vlan-zone">
                                                <option value="trust" selected>Trust</option>
                                                <option value="guest">Guest</option>
                                                <option value="voice">Voice</option>
                                                <option value="mgmt">Management</option>
                                            </select>
                                        </td>
                                        <td><button class="btn btn-secondary btn-icon" onclick="removeRow(this)">üóëÔ∏è</button></td>
                                    </tr>
                                    <tr>
                                        <td><input type="number" value="20" class="vlan-id"></td>
                                        <td><input type="text" value="Guest" class="vlan-name"></td>
                                        <td><input type="text" value="10.1.20.0/24" class="vlan-subnet"></td>
                                        <td><input type="text" value="10.1.20.1" class="vlan-gateway"></td>
                                        <td><input type="checkbox" checked class="vlan-dhcp"></td>
                                        <td>
                                            <select class="vlan-zone">
                                                <option value="trust">Trust</option>
                                                <option value="guest" selected>Guest</option>
                                                <option value="voice">Voice</option>
                                                <option value="mgmt">Management</option>
                                            </select>
                                        </td>
                                        <td><button class="btn btn-secondary btn-icon" onclick="removeRow(this)">üóëÔ∏è</button></td>
                                    </tr>
                                    <tr>
                                        <td><input type="number" value="30" class="vlan-id"></td>
                                        <td><input type="text" value="VoIP" class="vlan-name"></td>
                                        <td><input type="text" value="10.1.30.0/24" class="vlan-subnet"></td>
                                        <td><input type="text" value="10.1.30.1" class="vlan-gateway"></td>
                                        <td><input type="checkbox" checked class="vlan-dhcp"></td>
                                        <td>
                                            <select class="vlan-zone">
                                                <option value="trust">Trust</option>
                                                <option value="guest">Guest</option>
                                                <option value="voice" selected>Voice</option>
                                                <option value="mgmt">Management</option>
                                            </select>
                                        </td>
                                        <td><button class="btn btn-secondary btn-icon" onclick="removeRow(this)">üóëÔ∏è</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Step 5: Policies -->
                    <div class="step-content" data-step="5">
                        <div class="section">
                            <div class="section-header">
                                <div class="section-title">üéØ Application Routing Policies</div>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="policy-office365" checked>
                                <label for="policy-office365">Office 365 - Route via Internet (Direct)</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="policy-teams" checked>
                                <label for="policy-teams">Microsoft Teams - High Priority, Internet Preferred</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="policy-sap">
                                <label for="policy-sap">SAP/ERP - Route via MPLS (Private)</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="policy-backup">
                                <label for="policy-backup">Backups - Low Priority, Scheduled After Hours</label>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-header">
                                <div class="section-title">üìä QoS Configuration</div>
                            </div>
                            <div class="form-grid">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="qos-voip" checked>
                                    <label for="qos-voip">VoIP Priority (128 kbps guarantee)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="qos-video" checked>
                                    <label for="qos-video">Video Conferencing (2 Mbps guarantee)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="qos-business">
                                    <label for="qos-business">Business Critical Apps (50% bandwidth)</label>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-header">
                                <div class="section-title">üåê Internet Breakout (DIA)</div>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="dia-enable" checked>
                                <label for="dia-enable">Enable Local Internet Breakout</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="dia-office365" checked>
                                <label for="dia-office365">Breakout: Office 365</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="dia-zoom" checked>
                                <label for="dia-zoom">Breakout: Zoom/WebEx</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="dia-youtube">
                                <label for="dia-youtube">Breakout: YouTube/Streaming</label>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-header">
                                <div class="section-title">üîí Security Features</div>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="security-utm" checked>
                                <label for="security-utm">Enable Unified Threat Management (UTM)</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="security-ips" checked>
                                <label for="security-ips">IPS/IDS (Intrusion Prevention)</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="security-web">
                                <label for="security-web">Web Filtering</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="security-av">
                                <label for="security-av">Antivirus/Anti-Malware</label>
                            </div>
                        </div>
                    </div>

                    <!-- Step 6: Multi-Site Deployment -->
                    <div class="step-content" data-step="6">
                        <div class="section">
                            <div class="section-header">
                                <div class="section-title">üè¢ Site Selection</div>
                                <button class="btn btn-secondary" onclick="addSite()">‚ûï Add Site</button>
                            </div>
                            <div class="site-list" id="site-list">
                                <div class="site-item">
                                    <input type="checkbox" class="site-checkbox" checked>
                                    <div class="site-info">
                                        <div class="site-name">Branch-NYC-01</div>
                                        <div class="site-meta">Site ID: 1001 | Users: 50 | Region: US East</div>
                                    </div>
                                    <div class="site-status status-ready">Ready</div>
                                    <div class="site-score">95/100</div>
                                    <button class="btn btn-secondary btn-icon" onclick="editSite(this)">‚úèÔ∏è</button>
                                </div>
                                <div class="site-item">
                                    <input type="checkbox" class="site-checkbox" checked>
                                    <div class="site-info">
                                        <div class="site-name">Branch-LA-02</div>
                                        <div class="site-meta">Site ID: 1002 | Users: 75 | Region: US West</div>
                                    </div>
                                    <div class="site-status status-ready">Ready</div>
                                    <div class="site-score">92/100</div>
                                    <button class="btn btn-secondary btn-icon" onclick="editSite(this)">‚úèÔ∏è</button>
                                </div>
                                <div class="site-item">
                                    <input type="checkbox" class="site-checkbox">
                                    <div class="site-info">
                                        <div class="site-name">Branch-CHI-03</div>
                                        <div class="site-meta">Site ID: 1003 | Users: 30 | Region: US Central</div>
                                    </div>
                                    <div class="site-status status-warning">Warning</div>
                                    <div class="site-score">78/100</div>
                                    <button class="btn btn-secondary btn-icon" onclick="editSite(this)">‚úèÔ∏è</button>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-header">
                                <div class="section-title">üéØ Deployment Strategy</div>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Rollout Method</label>
                                    <select id="rollout-method">
                                        <option value="sequential">Sequential (one at a time)</option>
                                        <option value="parallel">Parallel (all at once)</option>
                                        <option value="phased" selected>Phased (pilot ‚Üí full)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Start Time</label>
                                    <input type="time" id="deploy-time" value="02:00">
                                </div>
                                <div class="form-group">
                                    <label>Maintenance Window</label>
                                    <select id="maintenance-window">
                                        <option value="2">2 hours</option>
                                        <option value="4" selected>4 hours</option>
                                        <option value="6">6 hours</option>
                                        <option value="8">8 hours</option>
                                    </select>
                                </div>
                            </div>
                            <div style="margin-top: 20px;">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="pre-backup" checked>
                                    <label for="pre-backup">Backup configuration before deployment</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="pre-validate" checked>
                                    <label for="pre-validate">Run pre-deployment validation checks</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="post-test" checked>
                                    <label for="post-test">Execute post-deployment tests</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="auto-rollback">
                                    <label for="auto-rollback">Enable automatic rollback on failure</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 7: Review & Generate -->
                    <div class="step-content" data-step="7">
                        <div class="summary-grid">
                            <div class="summary-card">
                                <div class="summary-label">üåê SD-WAN Platform</div>
                                <div class="summary-value" id="summary-vendor">Not Selected</div>
                                <div class="summary-detail">Multi-vendor support</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-label">üìç Sites Configured</div>
                                <div class="summary-value" id="summary-sites">1</div>
                                <div class="summary-detail">Ready for deployment</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-label">üîå WAN Circuits</div>
                                <div class="summary-value" id="summary-circuits">2</div>
                                <div class="summary-detail">Per site average</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-label">üè¢ VLANs Configured</div>
                                <div class="summary-value" id="summary-vlans">3</div>
                                <div class="summary-detail">With DHCP enabled</div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-header">
                                <div class="section-title">üì¶ Generated Ansible Playbooks</div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                                <div style="padding: 16px; background: rgba(14, 165, 233, 0.1); border-radius: 8px;">
                                    <strong>üìÑ main.yml</strong>
                                    <div style="font-size: 0.85em; color: var(--text-muted); margin-top: 4px;">Main playbook orchestration</div>
                                </div>
                                <div style="padding: 16px; background: rgba(14, 165, 233, 0.1); border-radius: 8px;">
                                    <strong>üìÑ site_config.yml</strong>
                                    <div style="font-size: 0.85em; color: var(--text-muted); margin-top: 4px;">Site-specific configuration</div>
                                </div>
                                <div style="padding: 16px; background: rgba(14, 165, 233, 0.1); border-radius: 8px;">
                                    <strong>üìÑ wan_circuits.yml</strong>
                                    <div style="font-size: 0.85em; color: var(--text-muted); margin-top: 4px;">WAN interface configuration</div>
                                </div>
                                <div style="padding: 16px; background: rgba(14, 165, 233, 0.1); border-radius: 8px;">
                                    <strong>üìÑ lan_vlans.yml</strong>
                                    <div style="font-size: 0.85em; color: var(--text-muted); margin-top: 4px;">VLAN and LAN setup</div>
                                </div>
                                <div style="padding: 16px; background: rgba(14, 165, 233, 0.1); border-radius: 8px;">
                                    <strong>üìÑ policies.yml</strong>
                                    <div style="font-size: 0.85em; color: var(--text-muted); margin-top: 4px;">QoS and routing policies</div>
                                </div>
                                <div style="padding: 16px; background: rgba(14, 165, 233, 0.1); border-radius: 8px;">
                                    <strong>üìÑ inventory.ini</strong>
                                    <div style="font-size: 0.85em; color: var(--text-muted); margin-top: 4px;">Site inventory</div>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 16px; margin-top: 32px;">
                            <button class="btn btn-primary" style="flex: 1;" onclick="showCodeModal()">
                                üíª View Generated Code
                            </button>
                            <button class="btn btn-success" style="flex: 1;" onclick="exportPlaybooks()">
                                üì• Download All Playbooks
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Footer Navigation -->
                <div class="footer-nav">
                    <button class="btn btn-secondary" id="prev-btn" onclick="previousStep()" style="display: none;">
                        ‚Üê Previous
                    </button>
                    <button class="btn btn-primary" id="next-btn" onclick="nextStep()">
                        Next Step ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Code Modal -->
    <div class="modal" id="code-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Generated Ansible Playbooks</div>
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-secondary" onclick="copyCurrentCode()">üìã Copy</button>
                    <button class="btn btn-secondary" onclick="closeCodeModal()">‚úï Close</button>
                </div>
            </div>
            <div class="modal-tabs">
                <button class="modal-tab active" data-file="main">main.yml</button>
                <button class="modal-tab" data-file="site">site_config.yml</button>
                <button class="modal-tab" data-file="wan">wan_circuits.yml</button>
                <button class="modal-tab" data-file="lan">lan_vlans.yml</button>
                <button class="modal-tab" data-file="policies">policies.yml</button>
                <button class="modal-tab" data-file="inventory">inventory.ini</button>
            </div>
            <div class="modal-body">
                <pre><code id="modal-code" class="language-yaml"># Generated code will appear here</code></pre>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let selectedVendor = null;
        let config = {
            vendor: '',
            site: {},
            wan: [],
            lan: [],
            policies: {},
            sites: [],
            deployment: {}
        };
        let generatedCode = {
            main: '',
            site: '',
            wan: '',
            lan: '',
            policies: '',
            inventory: ''
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Vendor selection
            document.querySelectorAll('.card[data-vendor]').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.card[data-vendor]').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedVendor = this.dataset.vendor;
                    config.vendor = selectedVendor;
                    saveToCache();
                });
            });

            // Step navigation
            document.querySelectorAll('.step-item').forEach(item => {
                item.addEventListener('click', function() {
                    const step = parseInt(this.dataset.step);
                    if (step <= currentStep || this.classList.contains('completed')) {
                        goToStep(step);
                    }
                });
            });

            // Modal tabs
            document.querySelectorAll('.modal-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    updateModalCode(this.dataset.file);
                });
            });

            // Auto-save on input changes
            document.getElementById('site-name')?.addEventListener('change', saveToCache);
            document.getElementById('site-id')?.addEventListener('change', saveToCache);

            // Load from cache on startup
            loadFromCache();
        });

        function goToStep(step) {
            if (step < 1 || step > 7) return;

            // Update step items
            document.querySelectorAll('.step-item').forEach(item => {
                item.classList.remove('active');
                const itemStep = parseInt(item.dataset.step);
                if (itemStep < step) {
                    item.classList.add('completed');
                } else {
                    item.classList.remove('completed');
                }
                if (itemStep === step) {
                    item.classList.add('active');
                }
            });

            // Update content
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
                if (parseInt(content.dataset.step) === step) {
                    content.classList.add('active');
                }
            });

            // Update header
            const titles = {
                1: { title: 'Select SD-WAN Vendor', desc: 'Choose your SD-WAN platform to begin configuration' },
                2: { title: 'Configure Site Details', desc: 'Define site information and location' },
                3: { title: 'Configure WAN Circuits', desc: 'Set up internet and MPLS connections' },
                4: { title: 'Configure LAN Networks', desc: 'Define VLANs and internal networks' },
                5: { title: 'Define Policies', desc: 'QoS, routing, and security policies' },
                6: { title: 'Multi-Site Deployment', desc: 'Select sites and deployment strategy' },
                7: { title: 'Review & Generate', desc: 'Review configuration and generate playbooks' }
            };

            document.getElementById('step-title').textContent = titles[step].title;
            document.getElementById('step-desc').textContent = titles[step].desc;

            // Update progress
            const progress = (step / 7) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `Step ${step} of 7`;

            // Update navigation buttons
            document.getElementById('prev-btn').style.display = step > 1 ? 'block' : 'none';
            document.getElementById('next-btn').textContent = step === 7 ? 'Generate Playbooks ‚ú®' : 'Next Step ‚Üí';

            currentStep = step;

            // Generate code on final step
            if (step === 7) {
                updateSummary();
                generateAllPlaybooks();
            }
        }

        function nextStep() {
            if (currentStep === 1 && !selectedVendor) {
                alert('Please select an SD-WAN vendor first');
                return;
            }
            if (currentStep < 7) {
                goToStep(currentStep + 1);
            } else {
                showCodeModal();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                goToStep(currentStep - 1);
            }
        }

        function addWanCircuit() {
            const table = document.getElementById('wan-table').querySelector('tbody');
            const row = table.insertRow();
            const circuitNum = table.rows.length;
            row.innerHTML = `
                <td><input type="text" value="WAN-${circuitNum}" class="wan-name"></td>
                <td>
                    <select class="wan-type">
                        <option value="internet">Internet</option>
                        <option value="mpls">MPLS</option>
                        <option value="4g">4G/LTE</option>
                        <option value="5g">5G</option>
                    </select>
                </td>
                <td><input type="text" placeholder="ISP name" class="wan-isp"></td>
                <td><input type="number" placeholder="100" class="wan-download"></td>
                <td><input type="number" placeholder="20" class="wan-upload"></td>
                <td><input type="text" placeholder="Public IP" class="wan-ip"></td>
                <td>
                    <select class="wan-priority">
                        <option value="1">Primary</option>
                        <option value="2">Backup</option>
                        <option value="3">Tertiary</option>
                    </select>
                </td>
                <td><button class="btn btn-secondary btn-icon" onclick="removeRow(this)">üóëÔ∏è</button></td>
            `;
            saveToCache();
        }

        function addLanVlan() {
            const table = document.getElementById('lan-table').querySelector('tbody');
            const row = table.insertRow();
            const vlanNum = (table.rows.length + 1) * 10;
            row.innerHTML = `
                <td><input type="number" value="${vlanNum}" class="vlan-id"></td>
                <td><input type="text" placeholder="VLAN name" class="vlan-name"></td>
                <td><input type="text" placeholder="10.1.X.0/24" class="vlan-subnet"></td>
                <td><input type="text" placeholder="10.1.X.1" class="vlan-gateway"></td>
                <td><input type="checkbox" class="vlan-dhcp"></td>
                <td>
                    <select class="vlan-zone">
                        <option value="trust">Trust</option>
                        <option value="guest">Guest</option>
                        <option value="voice">Voice</option>
                        <option value="mgmt">Management</option>
                    </select>
                </td>
                <td><button class="btn btn-secondary btn-icon" onclick="removeRow(this)">üóëÔ∏è</button></td>
            `;
            saveToCache();
        }

        function removeRow(btn) {
            btn.closest('tr').remove();
            saveToCache();
        }

        function addSite() {
            const siteList = document.getElementById('site-list');
            const siteNum = siteList.children.length + 1;
            const siteItem = document.createElement('div');
            siteItem.className = 'site-item';
            siteItem.innerHTML = `
                <input type="checkbox" class="site-checkbox">
                <div class="site-info">
                    <div class="site-name">New-Site-${siteNum.toString().padStart(2, '0')}</div>
                    <div class="site-meta">Site ID: ${1000 + siteNum} | Users: 25 | Region: TBD</div>
                </div>
                <div class="site-status status-warning">New</div>
                <div class="site-score">--/100</div>
                <button class="btn btn-secondary btn-icon" onclick="editSite(this)">‚úèÔ∏è</button>
            `;
            siteList.appendChild(siteItem);
            saveToCache();
        }

        function editSite(btn) {
            alert('Site editing feature - would open detailed configuration modal');
        }

        function updateSummary() {
            const vendorNames = {
                cisco: 'Cisco SD-WAN',
                fortinet: 'Fortinet SD-WAN',
                prisma: 'Prisma SD-WAN',
                velocloud: 'VMware VeloCloud'
            };
            document.getElementById('summary-vendor').textContent = selectedVendor ? vendorNames[selectedVendor] : 'Not Selected';
            
            const selectedSites = document.querySelectorAll('.site-checkbox:checked').length;
            document.getElementById('summary-sites').textContent = selectedSites || 1;
            
            const wanCount = document.querySelectorAll('#wan-table tbody tr').length;
            document.getElementById('summary-circuits').textContent = wanCount;
            
            const vlanCount = document.querySelectorAll('#lan-table tbody tr').length;
            document.getElementById('summary-vlans').textContent = vlanCount;
        }

        function generateAllPlaybooks() {
            if (!selectedVendor) {
                selectedVendor = 'cisco';
            }

            const siteName = document.getElementById('site-name')?.value || 'Branch-NYC-01';
            const siteId = document.getElementById('site-id')?.value || '1001';

            // Collect WAN data
            const wanCircuits = [];
            document.querySelectorAll('#wan-table tbody tr').forEach(row => {
                wanCircuits.push({
                    name: row.querySelector('.wan-name').value,
                    type: row.querySelector('.wan-type').value,
                    isp: row.querySelector('.wan-isp').value,
                    download: row.querySelector('.wan-download').value,
                    upload: row.querySelector('.wan-upload').value,
                    ip: row.querySelector('.wan-ip').value,
                    priority: row.querySelector('.wan-priority').value
                });
            });

            // Collect VLAN data
            const vlans = [];
            document.querySelectorAll('#lan-table tbody tr').forEach(row => {
                vlans.push({
                    id: row.querySelector('.vlan-id').value,
                    name: row.querySelector('.vlan-name').value,
                    subnet: row.querySelector('.vlan-subnet').value,
                    gateway: row.querySelector('.vlan-gateway').value,
                    dhcp: row.querySelector('.vlan-dhcp').checked,
                    zone: row.querySelector('.vlan-zone').value
                });
            });

            // Generate playbooks based on vendor
            if (selectedVendor === 'cisco') {
                generateCiscoPlaybooks(siteName, siteId, wanCircuits, vlans);
            } else if (selectedVendor === 'fortinet') {
                generateFortinetPlaybooks(siteName, siteId, wanCircuits, vlans);
            } else if (selectedVendor === 'prisma') {
                generatePrismaPlaybooks(siteName, siteId, wanCircuits, vlans);
            } else if (selectedVendor === 'velocloud') {
                generateVelocloudPlaybooks(siteName, siteId, wanCircuits, vlans);
            }
        }

        function generateCiscoPlaybooks(siteName, siteId, wanCircuits, vlans) {
            generatedCode.main = `---
# Cisco SD-WAN Deployment Playbook
# Generated by SD-WAN Automation Tool
# Site: ${siteName} (ID: ${siteId})

- name: Deploy Cisco SD-WAN Configuration
  hosts: cisco_sdwan_edges
  gather_facts: yes
  
  vars:
    vmanage_host: "{{ lookup('env', 'VMANAGE_HOST') }}"
    vmanage_username: "{{ lookup('env', 'VMANAGE_USER') }}"
    vmanage_password: "{{ lookup('env', 'VMANAGE_PASS') }}"
    site_id: "${siteId}"
    site_name: "${siteName}"

  tasks:
    - name: Include site configuration
      include_tasks: site_config.yml
      
    - name: Include WAN circuit configuration
      include_tasks: wan_circuits.yml
      
    - name: Include LAN VLAN configuration
      include_tasks: lan_vlans.yml
      
    - name: Include policy configuration
      include_tasks: policies.yml
      
    - name: Push configuration to vManage
      cisco.sdwan.config_push:
        vmanage_host: "{{ vmanage_host }}"
        vmanage_user: "{{ vmanage_username }}"
        vmanage_pass: "{{ vmanage_password }}"
        device_template: "{{ site_name }}-template"
        site_id: "{{ site_id }}"
      register: push_result
      
    - name: Wait for configuration to apply
      pause:
        seconds: 60
        
    - name: Verify device status
      cisco.sdwan.device_status:
        vmanage_host: "{{ vmanage_host }}"
        site_id: "{{ site_id }}"
      register: device_status
      
    - name: Display deployment status
      debug:
        msg: "Site {{ site_name }} deployed successfully. Status: {{ device_status.state }}"`;

            generatedCode.site = `---
# Site Configuration for ${siteName}

- name: Configure system settings
  cisco.sdwan.system:
    system_ip: "10.{{ site_id | int // 256 }}.{{ site_id | int % 256 }}.1"
    site_id: "{{ site_id }}"
    hostname: "{{ site_name }}"
    timezone: "America/New_York"
    location: "New York, NY"
    
- name: Configure device template
  cisco.sdwan.device_template:
    name: "{{ site_name }}-template"
    description: "Template for ${siteName}"
    device_type: "vedge-cloud"
    feature_templates:
      - system_template
      - vpn0_template
      - vpn512_template
      - vpn_lan_template`;

            generatedCode.wan = `---
# WAN Circuit Configuration

${wanCircuits.map((wan, idx) => `
- name: Configure ${wan.name} (${wan.type})
  cisco.sdwan.interface:
    name: "ge0/${idx}"
    description: "${wan.name} - ${wan.isp}"
    vpn: 0
    interface_type: "physical"
    ip_address: "${wan.ip}"
    bandwidth_downstream: ${wan.download}
    bandwidth_upstream: ${wan.upload}
    tunnel_interface:
      enabled: true
      color: "${wan.type === 'mpls' ? 'mpls' : 'biz-internet'}"
      encapsulation: "ipsec"
      allow_service:
        - dhcp
        - dns
        - icmp
      max_control_connections: 2
    nat: ${wan.type === 'internet' ? 'true' : 'false'}`).join('\n')}

- name: Configure WAN policy
  cisco.sdwan.policy:
    name: "wan-control-policy"
    type: "control"
    sequences:
      - sequence_id: 1
        match:
          color: "biz-internet"
        action:
          accept:
            set:
              preference: 100
      - sequence_id: 2
        match:
          color: "mpls"
        action:
          accept:
            set:
              preference: 200`;

            generatedCode.lan = `---
# LAN VLAN Configuration

${vlans.map(vlan => `
- name: Configure VLAN ${vlan.id} - ${vlan.name}
  cisco.sdwan.vpn_interface:
    vpn: 1
    interface: "ge0/0.${vlan.id}"
    description: "${vlan.name} Network"
    ip_address: "${vlan.gateway}"
    dhcp_server:
      enabled: ${vlan.dhcp}
      address_pool: "${vlan.subnet}"
      exclude: 
        - "${vlan.gateway}"
      lease_time: 86400
    security_zone: "${vlan.zone}"`).join('\n')}

- name: Configure inter-VLAN routing
  cisco.sdwan.routing:
    vpn: 1
    protocol: "static"
    routes:
${vlans.map(vlan => `      - prefix: "${vlan.subnet}"
        next_hop: "${vlan.gateway}"`).join('\n')}`;

            generatedCode.policies = `---
# Application-Aware Routing & QoS Policies

- name: Configure application-aware routing
  cisco.sdwan.app_route_policy:
    name: "app-routing-policy"
    sequences:
      - sequence_id: 10
        match:
          application: "microsoft-office-365"
        action:
          backup_sla_preferred_color: "biz-internet"
          sla_class:
            - name: "realtime"
              preferred_color: "biz-internet"
              
      - sequence_id: 20
        match:
          application: "microsoft-teams"
        action:
          sla_class:
            - name: "realtime"
              preferred_color: "biz-internet"
              
      - sequence_id: 30
        match:
          application: "sap-erp"
        action:
          preferred_color: "mpls"

- name: Configure QoS policy
  cisco.sdwan.qos_policy:
    name: "qos-policy"
    qos_schedulers:
      - queue: 0
        class: "voice"
        bandwidth_percent: 10
        drops: "tail-drop"
      - queue: 1
        class: "video"
        bandwidth_percent: 20
        drops: "tail-drop"
      - queue: 2
        class: "business-critical"
        bandwidth_percent: 30
        drops: "red-drop"
      - queue: 3
        class: "best-effort"
        bandwidth_percent: 40
        drops: "red-drop"`;

            generatedCode.inventory = `# Ansible Inventory for Cisco SD-WAN Deployment

[cisco_sdwan_edges]
${siteName.toLowerCase().replace(/\s+/g, '-')} ansible_host=192.0.2.1 site_id=${siteId}

[cisco_sdwan_edges:vars]
ansible_connection=network_cli
ansible_network_os=ios
ansible_user=admin
ansible_password={{ vault_password }}
ansible_become=yes
ansible_become_method=enable

[vmanage]
vmanage-1 ansible_host=vmanage.company.com

[vmanage:vars]
ansible_connection=httpapi
ansible_httpapi_use_ssl=yes
ansible_httpapi_validate_certs=no
ansible_network_os=cisco.sdwan.sdwan

# Group variables can be defined in group_vars/
# Sensitive data should be encrypted with ansible-vault`;
        }

        function generateFortinetPlaybooks(siteName, siteId, wanCircuits, vlans) {
            generatedCode.main = `---
# Fortinet SD-WAN Deployment Playbook
# Site: ${siteName}

- name: Deploy Fortinet SD-WAN Configuration
  hosts: fortigate_devices
  collections:
    - fortinet.fortios
  
  vars:
    site_name: "${siteName}"
    site_id: "${siteId}"
    
  tasks:
    - name: Configure system settings
      fortios_system_global:
        system_global:
          hostname: "{{ site_name }}"
          timezone: "04"
          
    - name: Include WAN configuration
      include_tasks: wan_circuits.yml
      
    - name: Include LAN configuration
      include_tasks: lan_vlans.yml
      
    - name: Include SD-WAN policies
      include_tasks: policies.yml`;

            generatedCode.wan = `---
# Fortinet WAN Interface Configuration

${wanCircuits.map((wan, idx) => `
- name: Configure ${wan.name}
  fortios_system_interface:
    system_interface:
      name: "port${idx + 1}"
      mode: "static"
      ip: "${wan.ip.split('/')[0]} 255.255.255.252"
      allowaccess: "ping https ssh"
      role: "wan"
      description: "${wan.name} - ${wan.isp}"`).join('\n')}

- name: Configure SD-WAN zone
  fortios_system_sdwan:
    system_sdwan:
      status: "enable"
      members:
${wanCircuits.map((wan, idx) => `        - seq_num: ${idx + 1}
          interface: "port${idx + 1}"
          zone: "virtual-wan-link"
          gateway: "${wan.ip.split('.').slice(0, 3).join('.')}.1"
          priority: ${wan.priority}`).join('\n')}`;

            generatedCode.lan = `---
# Fortinet VLAN Configuration

${vlans.map(vlan => `
- name: Configure VLAN ${vlan.id}
  fortios_system_interface:
    system_interface:
      name: "vlan${vlan.id}"
      vdom: "root"
      type: "vlan"
      vlanid: ${vlan.id}
      interface: "internal"
      ip: "${vlan.gateway} 255.255.255.0"
      allowaccess: "ping https ssh"
      role: "lan"
      
- name: Configure DHCP server for VLAN ${vlan.id}
  fortios_system_dhcp_server:
    system_dhcp_server:
      id: ${vlan.id}
      interface: "vlan${vlan.id}"
      default_gateway: "${vlan.gateway}"
      netmask: "255.255.255.0"
      start_ip: "${vlan.subnet.split('/')[0].split('.').slice(0, 3).join('.')}.100"
      end_ip: "${vlan.subnet.split('/')[0].split('.').slice(0, 3).join('.')}.200"
      dns_server1: "${vlan.gateway}"
      lease_time: 86400`).join('\n')}`;

            generatedCode.policies = `---
# Fortinet SD-WAN Policies

- name: Configure SD-WAN health check
  fortios_system_sdwan:
    system_sdwan:
      health_check:
        - name: "internet-check"
          server: "8.8.8.8"
          protocol: "ping"
          interval: 10
          failtime: 5
          recoverytime: 5
          
- name: Configure application steering
  fortios_firewall_policy:
    firewall_policy:
      policyid: 1
      name: "Office365-Direct"
      srcintf:
        - name: "internal"
      dstintf:
        - name: "virtual-wan-link"
      srcaddr:
        - name: "all"
      dstaddr:
        - name: "Office365"
      action: "accept"
      schedule: "always"
      service:
        - name: "ALL"
      utm_status: "enable"
      ssl_ssh_profile: "certificate-inspection"
      application_list: "default"
      logtraffic: "all"`;

            generatedCode.inventory = `[fortigate_devices]
${siteName.toLowerCase().replace(/\s+/g, '-')} ansible_host=192.0.2.1

[fortigate_devices:vars]
ansible_network_os=fortinet.fortios.fortios
ansible_connection=httpapi
ansible_httpapi_use_ssl=yes
ansible_httpapi_validate_certs=no
ansible_user=admin
ansible_password={{ vault_password }}`;
        }

        function generatePrismaPlaybooks(siteName, siteId, wanCircuits, vlans) {
            generatedCode.main = `---
# Prisma SD-WAN ION Deployment
# Site: ${siteName}

- name: Deploy Prisma SD-WAN Configuration
  hosts: prisma_ions
  
  vars:
    prisma_client_id: "{{ lookup('env', 'PRISMA_CLIENT_ID') }}"
    prisma_client_secret: "{{ lookup('env', 'PRISMA_CLIENT_SECRET') }}"
    site_name: "${siteName}"
    
  tasks:
    - name: Authenticate to Prisma SD-WAN
      uri:
        url: "https://api.sase.paloaltonetworks.com/sse/config/v1/login"
        method: POST
        body_format: json
        body:
          client_id: "{{ prisma_client_id }}"
          client_secret: "{{ prisma_client_secret }}"
      register: auth_token
      
    - name: Create site configuration
      include_tasks: site_config.yml`;

            generatedCode.site = `---
# Prisma SD-WAN Site Configuration

- name: Create site
  uri:
    url: "https://api.sase.paloaltonetworks.com/sdwan/v4.9/api/sites"
    method: POST
    headers:
      Authorization: "Bearer {{ auth_token.json.access_token }}"
    body_format: json
    body:
      name: "${siteName}"
      description: "Automated deployment"
      address:
        street: "123 Main St"
        city: "New York"
        state: "NY"
        country: "US"
        zipcode: "10001"
      location:
        latitude: 40.7128
        longitude: -74.0060
  register: site_result`;

            generatedCode.wan = `---
# Prisma SD-WAN WAN Configuration

${wanCircuits.map(wan => `
- name: Configure ${wan.name}
  uri:
    url: "https://api.sase.paloaltonetworks.com/sdwan/v4.9/api/waninterfaces"
    method: POST
    headers:
      Authorization: "Bearer {{ auth_token.json.access_token }}"
    body_format: json
    body:
      name: "${wan.name}"
      description: "${wan.isp}"
      type: "${wan.type}"
      bw_config_mode: "manual"
      bwc_enabled: true
      link_bw_down: ${wan.download}
      link_bw_up: ${wan.upload}`).join('\n')}`;

            generatedCode.lan = `---
# Prisma SD-WAN LAN Configuration

${vlans.map(vlan => `
- name: Create network for VLAN ${vlan.id}
  uri:
    url: "https://api.sase.paloaltonetworks.com/sdwan/v4.9/api/site_networks"
    method: POST
    body_format: json
    body:
      name: "${vlan.name}"
      type: "lan"
      subnet: "${vlan.subnet}"
      dhcp_relay: ${vlan.dhcp}
      security_zone: "${vlan.zone}"`).join('\n')}`;

            generatedCode.policies = `---
# Prisma SD-WAN Policies

- name: Create application policy
  uri:
    url: "https://api.sase.paloaltonetworks.com/sdwan/v4.9/api/policy_rules"
    method: POST
    body_format: json
    body:
      name: "Office365-Steering"
      app_def_ids: ["office365"]
      paths_allowed:
        - path_type: "internet"
          label: "public-internet"`;

            generatedCode.inventory = `[prisma_ions]
${siteName.toLowerCase().replace(/\s+/g, '-')} site_id=${siteId}

[prisma_ions:vars]
ansible_connection=local
ansible_python_interpreter=/usr/bin/python3`;
        }

        function generateVelocloudPlaybooks(siteName, siteId, wanCircuits, vlans) {
            generatedCode.main = `---
# VMware VeloCloud SD-WAN Deployment
# Site: ${siteName}

- name: Deploy VeloCloud Edge Configuration
  hosts: velocloud_edges
  
  vars:
    vco_hostname: "vco.company.com"
    enterprise_id: "1"
    
  tasks:
    - name: Configure edge
      include_tasks: site_config.yml`;

            generatedCode.wan = `---
# VeloCloud WAN Configuration

${wanCircuits.map(wan => `
- name: Configure ${wan.name}
  velocloud_edge_interface:
    name: "${wan.name}"
    type: "WAN"
    addressing: "STATIC"
    cidr_ip: "${wan.ip}"
    gateway: "${wan.ip.split('.').slice(0, 3).join('.')}.1"
    wan_overlay: "AUTO_DISCOVERED"
    wan_link_info:
      isp_name: "${wan.isp}"
      bandwidth_down: ${wan.download}
      bandwidth_up: ${wan.upload}`).join('\n')}`;

            generatedCode.lan = `---
# VeloCloud LAN Configuration

${vlans.map(vlan => `
- name: Configure ${vlan.name}
  velocloud_edge_interface:
    name: "LAN_VLAN_${vlan.id}"
    type: "LAN"
    vlan_id: ${vlan.id}
    addressing: "STATIC"
    cidr_ip: "${vlan.gateway}/24"
    dhcp:
      enabled: ${vlan.dhcp}
      lease_time_seconds: 86400`).join('\n')}`;

            generatedCode.policies = `---
# VeloCloud Business Policies

- name: Create business policy
  velocloud_business_policy:
    name: "Application-Steering"
    rules:
      - name: "Office365-Direct"
        match:
          app_id: "office365"
        action:
          edge_route:
            - interface: "AUTO_DISCOVERED"
              prefer: "PUBLIC_WAN"`;

            generatedCode.inventory = `[velocloud_edges]
${siteName.toLowerCase().replace(/\s+/g, '-')} ansible_host=192.0.2.1

[velocloud_edges:vars]
ansible_connection=local`;
        }

        function showCodeModal() {
            document.getElementById('code-modal').classList.add('show');
            updateModalCode('main');
        }

        function closeCodeModal() {
            document.getElementById('code-modal').classList.remove('show');
        }

        function updateModalCode(file) {
            const code = generatedCode[file] || '# No code generated';
            const output = document.getElementById('modal-code');
            output.textContent = code;
            if (window.Prism) {
                Prism.highlightElement(output);
            }
        }

        function copyCurrentCode() {
            const activeTab = document.querySelector('.modal-tab.active');
            const file = activeTab.dataset.file;
            const code = generatedCode[file];
            navigator.clipboard.writeText(code).then(() => {
                alert('‚úì Code copied to clipboard!');
            });
        }

        function exportPlaybooks() {
            const files = {
                'main.yml': generatedCode.main,
                'site_config.yml': generatedCode.site,
                'wan_circuits.yml': generatedCode.wan,
                'lan_vlans.yml': generatedCode.lan,
                'policies.yml': generatedCode.policies,
                'inventory.ini': generatedCode.inventory,
                'README.md': generateReadme()
            };

            Object.entries(files).forEach(([filename, content]) => {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            });

            alert('‚úì All playbooks downloaded successfully!');
        }

        function generateReadme() {
            const vendor = selectedVendor || 'sdwan';
            return `# ${vendor.toUpperCase()} SD-WAN Deployment

Generated by SD-WAN Automation Tool

## Prerequisites

- Ansible >= 2.9
- Required collections:
  - ${vendor === 'cisco' ? 'cisco.sdwan' : ''}
  - ${vendor === 'fortinet' ? 'fortinet.fortios' : ''}
  - ${vendor === 'prisma' ? 'paloaltonetworks.prisma' : ''}
  - ${vendor === 'velocloud' ? 'vmware.velocloud' : ''}

## Installation

\`\`\`bash
ansible-galaxy collection install ${vendor === 'cisco' ? 'cisco.sdwan' : vendor === 'fortinet' ? 'fortinet.fortios' : 'community.general'}
\`\`\`

## Usage

\`\`\`bash
# Run playbook
ansible-playbook -i inventory.ini main.yml

# Dry-run mode
ansible-playbook -i inventory.ini main.yml --check

# With vault password
ansible-playbook -i inventory.ini main.yml --ask-vault-pass
\`\`\`

## Files

- **main.yml**: Main orchestration playbook
- **site_config.yml**: Site-specific configuration
- **wan_circuits.yml**: WAN interface configuration
- **lan_vlans.yml**: LAN VLAN configuration
- **policies.yml**: QoS and routing policies
- **inventory.ini**: Ansible inventory

## Configuration

Edit inventory.ini and update:
- Device hostnames/IPs
- Credentials (use ansible-vault)
- Site-specific variables

## Support

Generated: ${new Date().toISOString()}
Tool: SD-WAN Automation - https://github.com/yourrepo
`;
        }

        // Cache Management
        function saveToCache() {
            config.vendor = selectedVendor;
            config.site = {
                name: document.getElementById('site-name')?.value,
                id: document.getElementById('site-id')?.value,
                type: document.getElementById('site-type')?.value,
                timezone: document.getElementById('site-timezone')?.value
            };

            localStorage.setItem('sdwan-config', JSON.stringify(config));
            localStorage.setItem('sdwan-timestamp', Date.now().toString());
        }

        function loadFromCache() {
            const cached = localStorage.getItem('sdwan-config');
            if (cached) {
                try {
                    config = JSON.parse(cached);
                    
                    // Restore vendor selection
                    if (config.vendor) {
                        selectedVendor = config.vendor;
                        const vendorCard = document.querySelector(`.card[data-vendor="${config.vendor}"]`);
                        if (vendorCard) {
                            vendorCard.classList.add('selected');
                        }
                    }
                    
                    // Restore site info
                    if (config.site) {
                        if (document.getElementById('site-name')) {
                            document.getElementById('site-name').value = config.site.name || '';
                        }
                        if (document.getElementById('site-id')) {
                            document.getElementById('site-id').value = config.site.id || '';
                        }
                    }
                    
                    const timestamp = localStorage.getItem('sdwan-timestamp');
                    if (timestamp) {
                        const age = Math.floor((Date.now() - parseInt(timestamp)) / 1000 / 60);
                        console.log(`Loaded configuration from cache (${age} minutes ago)`);
                    }
                } catch (e) {
                    console.error('Failed to load cached config:', e);
                }
            }
        }

        function clearCache() {
            if (confirm('Are you sure you want to clear all saved data?')) {
                localStorage.removeItem('sdwan-config');
                localStorage.removeItem('sdwan-timestamp');
                location.reload();
            }
        }

        // Close modal on background click
        document.getElementById('code-modal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeCodeModal();
            }
        });
    </script>
</body>
</html>
